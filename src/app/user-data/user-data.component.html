<div class="container">
    <h1 class="mt-4"> User Data Management </h1>
    <div class="user-data mt-5">
        <table class="table table-bordered">
            <thead>
                <tr>
                    @for (header of tableData; track $index) {
                    <th> {{header.title}} </th>
                    }
                </tr>
            </thead>
            <tbody>
                @for (user of users; track user.id) {
                <tr>
                    @for (header of tableData; track $index) {

                        @if (header.field == 'id') {
                            <td> {{user.id}} </td>

                        } @else if(header.field != 'action') {
                            <td>
                                @if (!user.isEditing) {
                                    {{ user[header.field]}}
                                } @else {
                                <form [formGroup]="user.form!">
                                    <input type="text" class="form-control" [placeholder]="header.title"
                                        [formControlName]="header.field" />
                                    @if (user.form?.get(header.field)?.touched && user.form?.get(header.field)?.invalid) {
                                        <div class="text-danger small"> {{header.title}} is required </div>
                                    }
                                </form>
                                }
                            </td>
                        } @else {
                             <td>
                                <div class="d-flex">
                                    @if (!user.isEditing) {
                                        <button class="btn btn-primary btn-sm me-2" (click)="userEdit(user)">Edit</button>
                                    } @else {
                                        <button class="btn btn-success btn-sm me-2" (click)="save(user)" [disabled]="user.form?.invalid"> Save </button>
                                        <button class="btn btn-danger btn-sm me-2" (click)="cancel(user)">Cancel</button>
                                    }
                                    <button class="btn btn-sm me-2" [ngClass]="user.viewUser ? 'btn-danger': 'btn-success'" (click)="view(user)">
                                        {{ user.viewUser ? 'Close': 'View' }}
                                    </button>
                                </div>
                            </td>
                        }
                    }

                   
                </tr>

                @if (user.viewUser) {
                <tr>
                    <td colspan="6">
                        <div class="p-3 bg-light border rounded">
                            <p class="p-0 m-0"><strong>ID:</strong> {{ user.id }}</p>
                            <p class="p-0 m-0"><strong>Name:</strong> {{ user.name }}</p>
                            <p class="p-0 m-0"><strong>Bio:</strong> {{ user.bio }}</p>
                            <p class="p-0 m-0"><strong> Language : </strong> {{user.language}} </p>
                            <p class="p-0 m-0"><strong> Version : </strong> {{user.version}} </p>
                        </div>
                    </td>
                </tr>
                }
                }
            </tbody>
        </table>
    </div>
</div>